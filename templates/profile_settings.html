<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Settings | Seven33 Blog</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class' };</script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">

<header class="flex flex-col sm:flex-row justify-between items-center p-4 bg-white dark:bg-gray-800 shadow sticky top-0 z-50">
    <h1 class="text-xl font-bold mb-2 sm:mb-0">‚öôÔ∏è Profile Settings</h1>
    <div class="flex items-center space-x-4">
        <nav class="flex space-x-4">
            <a href="{{ url_for('public_home') }}" class="text-blue-600 dark:text-blue-400 hover:underline">Home</a>
            <a href="{{ url_for('dashboard') }}" class="text-green-600 dark:text-green-400 hover:underline">Dashboard</a>
            <a href="{{ url_for('logout') }}" class="text-red-600 dark:text-red-400 hover:underline">Logout</a>
        </nav>
        <button id="darkToggle" class="px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition">üí°</button>
    </div>
</header>

<div class="max-w-2xl mx-auto p-4 mt-6">
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        {% for message in messages %}
          <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
        <form method="POST" enctype="multipart/form-data" class="space-y-6">
            <div class="text-center">
                <h3 class="text-lg font-semibold mb-4">Profile Picture</h3>
                <div class="flex justify-center mb-4" id="imageContainer">
                    {% if user.profile_pic and user.profile_pic != 'default-avatar.png' %}
                        <img id="preview" src="{{ url_for('uploaded_file', filename=user.profile_pic) }}" alt="Profile" class="w-32 h-32 rounded-full object-cover border-4 border-gray-300 dark:border-gray-600">
                    {% else %}
                        <div id="preview" class="w-32 h-32 rounded-full bg-blue-600 flex items-center justify-center text-white text-4xl font-bold border-4 border-gray-300 dark:border-gray-600">
                            {{ user.username[0] | upper }}
                        </div>
                    {% endif %}
                </div>

                <div class="flex justify-center">
                    <label class="cursor-pointer">
                        <span class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-semibold inline-block">
                            üì∑ Upload New Picture
                        </span>
                        <input type="file" name="profile_pic" accept="image/*" class="hidden" id="profilePicInput" onchange="previewImage(event)">
                    </label>
                </div>
            </div>

            <div>
                <label class="block text-sm font-semibold mb-2">Bio</label>
                <textarea name="bio" rows="4" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-blue-500 focus:outline-none">{{ user.bio or '' }}</textarea>
            </div>

            <div class="border-t border-gray-200 dark:border-gray-700 pt-4 text-sm space-y-2">
                <p><span class="font-semibold">Username:</span> {{ user.username }}</p>
                <p><span class="font-semibold">Account Type:</span> {{ 'Admin' if user.is_admin else 'User' }}</p>
            </div>

            <div class="flex gap-3">
                <button type="submit" class="flex-1 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-semibold">üíæ Save Changes</button>
                <a href="{{ url_for('dashboard') }}" class="flex-1 px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition font-semibold text-center">Cancel</a>
            </div>
        </form>
    </div>
</div>

<script>
function previewImage(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const container = document.getElementById('imageContainer');
            container.innerHTML = `<img id="preview" src="${e.target.result}" alt="Preview" class="w-32 h-32 rounded-full object-cover border-4 border-gray-300 dark:border-gray-600">`;
        }
        reader.readAsDataURL(file);
    }
}

const darkToggle = document.getElementById('darkToggle');
if(localStorage.getItem('darkMode') === 'true') document.documentElement.classList.add('dark');
darkToggle.addEventListener('click', () => {
    document.documentElement.classList.toggle('dark');
    localStorage.setItem('darkMode', document.documentElement.classList.contains('dark'));
});
</script>
</body>
</html>
